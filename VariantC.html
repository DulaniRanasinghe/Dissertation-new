<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Variant C - Progressive Disclosure Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in-down { animation: fadeInDown 0.5s ease-out forwards; }
        .locked-content { filter: blur(4px); pointer-events: none; user-select: none; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;


        const Check = ({ size = 16 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"></polyline></svg>;
        const Lock = ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>;

        const STEPS_META = {
            1: { name: 'Personal Information' },
            2: { name: 'Address Information' },
            3: { name: 'Employment/Study Status' },
            4: { name: 'Core Education' },
            5: { name: 'Job Preferences' }
        };

        const ALL_FIELDS = [
            { name: 'fullName', label: 'Full Name', required: true, type: 'text', step: 1 },
            { name: 'dateOfBirth', label: 'Date of Birth', required: true, type: 'date-composite', step: 1 },
            { name: 'email', label: 'Email', required: true, type: 'email', step: 1 },
            { name: 'phone', label: 'Phone Number', required: true, type: 'tel', step: 1 },
            { name: 'streetAddress', label: 'Street Address', required: true, type: 'text', colSpan: 2, step: 2 },
            { name: 'city', label: 'City', required: true, type: 'text', step: 2 },
            { name: 'postcode', label: 'Postcode', required: true, type: 'text', step: 2 },
            { name: 'country', label: 'Country', required: true, type: 'text', colSpan: 2, step: 2 },
            { name: 'employmentStatus', label: 'Current Status', required: true, type: 'select', colSpan: 2, step: 3 },
            { name: 'currentEmployer', label: 'Current Employer', required: true, type: 'text', step: 3, conditional: 'employed' },
            { name: 'jobTitle', label: 'Job Title', required: true, type: 'text', step: 3, conditional: 'employed' },
            { name: 'yearsExperience', label: 'Years of Experience', required: false, type: 'number-select', step: 3, conditional: 'employed' },
            { name: 'studentInstitution', label: 'Institution Name', required: true, type: 'text', step: 3, conditional: 'student' },
            { name: 'expectedGraduation', label: 'Expected Graduation Date', required: true, type: 'date', step: 3, conditional: 'student' },
            { name: 'lastEmployer', label: 'Last Employer', required: true, type: 'text', step: 3, conditional: 'unemployed' },
            { name: 'dateLeft', label: 'Date Left', required: true, type: 'date', step: 3, conditional: 'unemployed' },
            { name: 'highestQualification', label: 'Highest Completed Qualification', required: true, type: 'text', step: 4 },
            { name: 'institutionName', label: 'Institution Name', required: true, type: 'text', step: 4 },
            { name: 'yearCompletion', label: 'Year of Completion', required: true, type: 'year-select', step: 4, futureYears: 5 },
            { name: 'desiredPosition', label: 'Desired Position', required: true, type: 'select', step: 5 },
            { name: 'startDate', label: 'Earliest Start Date', required: true, type: 'date', step: 5 },
            { name: 'salaryExpectations', label: 'Salary Expectations ($USD)', required: false, type: 'text', step: 5 },
            { name: 'coverLetter', label: 'Cover Letter (Optional)', required: false, type: 'textarea', colSpan: 2, step: 5 },
            { name: 'cv', label: 'Upload CV/Resume', required: true, type: 'file', colSpan: 2, step: 5 }
        ];

        async function sendToGoogleSheets(dataType, data) {
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: dataType, ...data })
                });
                const result = await response.json();
                console.log('✅ Data sent:', result);
                return true;
            } catch (error) {
                console.error('❌ Error sending data:', error);
                return false;
            }
        }

        function ProgressiveForm() {
            const [step, setStep] = useState(1);
            const [formData, setFormData] = useState({ employmentStatus: '', cv: null });
            const [errors, setErrors] = useState({});
            const [logs, setLogs] = useState([]);
            const [firstInteraction, setFirstInteraction] = useState(null);
            const [fieldTimers, setFieldTimers] = useState({});
            const [fieldStartTime, setFieldStartTime] = useState({});
            const [errorCategories, setErrorCategories] = useState({ missing_required: 0, invalid_format: 0, incomplete_data: 0 });

            const getParticipantId = () => {
                const storedData = JSON.parse(localStorage.getItem('formStudyData') || '{}');
                if (storedData.participantId) return storedData.participantId;
                let maxNumber = 0;
                ['logs_A', 'logs_B', 'logs_C'].forEach(key => {
                    const logs = JSON.parse(localStorage.getItem(key) || '{}');
                    Object.keys(logs).forEach(pid => {
                        const match = pid.match(/^P(\d+)$/);
                        if (match && parseInt(match[1]) > maxNumber) maxNumber = parseInt(match[1]);
                    });
                });
                const newId = `P${maxNumber + 1}`;
                localStorage.setItem('formStudyData', JSON.stringify({ ...storedData, participantId: newId }));
                return newId;
            };

            const participantId = useRef(getParticipantId());
            const errorModalRef = useRef(null);

            useEffect(() => { addLog('formLoad', { timestamp: performance.now() }); }, []);
            useEffect(() => { addLog('stepViewed', { step, stepName: STEPS_META[step].name }); }, [step]);

            const addLog = (eventType, data = {}) => {
                setLogs(prev => [...prev, { participantID: participantId.current, variant: 'C', timestamp: performance.now(), event: eventType, step, ...data }]);
            };

            useEffect(() => {
                if (logs.length > 0) {
                    const allLogs = JSON.parse(localStorage.getItem('logs_C') || '{}');
                    allLogs[participantId.current] = logs;
                    localStorage.setItem('logs_C', JSON.stringify(allLogs));
                }
            }, [logs]);

            const validateField = useCallback((name, value, required, type) => {
                if (required) {
                    if (name === 'cv' && !formData.cv) return { error: 'CV/Resume is required', errorType: 'missing_required' };
                    if (!value || (typeof value === 'string' && !value.trim())) 
                        return { error: `${ALL_FIELDS.find(f => f.name === name)?.label || name} is required`, errorType: 'missing_required' };
                }
                if (!value) return { error: '', errorType: '' };
                if (type === 'email' && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) return { error: 'Invalid email format', errorType: 'invalid_format' };
                if (name === 'yearCompletion') {
                    const val = parseInt(value), currentYear = new Date().getFullYear();
                    if (val > currentYear + 10 || val < 1900) return { error: 'Invalid year', errorType: 'invalid_format' };
                }
                return { error: '', errorType: '' };
            }, [formData]);

            const getRequiredFieldsForStep = (currentStep) => {
                let fields = ALL_FIELDS.filter(f => f.step === currentStep);
                if (currentStep === 3) {
                    const status = formData.employmentStatus;
                    fields = status ? fields.filter(f => !f.conditional || f.conditional === status) : fields.filter(f => !f.conditional);
                }
                return fields.filter(f => f.required);
            };

            const validateStep = useCallback((currentStep) => {
                const requiredFields = getRequiredFieldsForStep(currentStep);
                const newErrors = {};
                let errorCounts = { missing_required: 0, invalid_format: 0, incomplete_data: 0 };
                
                requiredFields.forEach(field => {
                    if (field.type === 'date-composite') {
                        const { dobYear, dobMonth, dobDay } = formData;
                        if (!dobYear || !dobMonth || !dobDay) {
                            newErrors['dateOfBirth'] = 'Please complete your full date of birth.';
                            errorCounts['incomplete_data']++;
                            addLog('validationError', { fieldName: 'dateOfBirth', errorType: 'incomplete_data', errorMessage: 'Incomplete Date of Birth', fieldValue: `${dobYear || ''}-${dobMonth || ''}-${dobDay || ''}` });
                        }
                    } else {
                        const { error, errorType } = validateField(field.name, formData[field.name], field.required, field.type);
                        if (error) {
                            newErrors[field.name] = error;
                            if (errorType) errorCounts[errorType]++;
                            addLog('validationError', { fieldName: field.name, errorType, errorMessage: error, fieldValue: field.type === 'file' ? (formData[field.name]?.name || '') : (formData[field.name] || '') });
                        }
                    }
                });

                setErrors(prevErrors => {
                    const currentStepFieldNames = ALL_FIELDS.filter(f => f.step === currentStep).map(f => f.name);
                    const filteredErrors = Object.keys(prevErrors).filter(name => !currentStepFieldNames.includes(name)).reduce((acc, name) => ({ ...acc, [name]: prevErrors[name] }), {});
                    return { ...filteredErrors, ...newErrors };
                });

                setErrorCategories(prev => ({ missing_required: prev.missing_required + errorCounts.missing_required, invalid_format: prev.invalid_format + errorCounts.invalid_format, incomplete_data: prev.incomplete_data + errorCounts.incomplete_data }));
                return Object.keys(newErrors).length === 0;
            }, [formData, addLog, validateField]);

            const handleFocus = (fieldName) => {
                if (!firstInteraction) {
                    setFirstInteraction(performance.now());
                    addLog('firstInteraction', { fieldName });
                }
                const focusTime = performance.now();
                setFieldStartTime(prev => ({ ...prev, [fieldName]: focusTime }));
                addLog('fieldFocus', { fieldName, currentValue: formData[fieldName] || '' });
            };

            const handleBlur = (fieldName, value, type) => {
                const blurTime = performance.now(), startTime = fieldStartTime[fieldName];
                const timeSpent = startTime ? ((blurTime - startTime) / 1000).toFixed(2) : 0;
                setFieldTimers(prev => ({ ...prev, [fieldName]: (prev[fieldName] || 0) + parseFloat(timeSpent) }));
                addLog('fieldBlur', { fieldName, timeSpentSeconds: parseFloat(timeSpent), finalValue: value || '' });
                const field = ALL_FIELDS.find(f => f.name === fieldName);
                if (field && field.type !== 'date-composite' && field.type !== 'file') {
                    const { error, errorType } = validateField(fieldName, value, field.required, type);
                    setErrors(prev => {
                        const newErrors = { ...prev };
                        if (error) {
                            newErrors[fieldName] = error;
                            if (errorType) setErrorCategories(prevCat => ({ ...prevCat, [errorType]: prevCat[errorType] + 1 }));
                            addLog('validationError', { fieldName, errorType, errorMessage: error, fieldValue: value || '' });
                        } else {
                            delete newErrors[fieldName];
                        }
                        return newErrors;
                    });
                }
            };

            const handleChange = (e) => {
                const { name, value, type, files } = e.target;
                if (type === 'file') {
                    const file = files[0];
                    setFormData(prev => ({ ...prev, [name]: file }));
                    if (file) {
                        setErrors(prev => {
                            const newErrors = { ...prev };
                            delete newErrors[name];
                            return newErrors;
                        });
                    }
                    addLog('fieldInput', { fieldName: name, newValue: file ? file.name : '', fileSize: file ? file.size : 0 });
                    return;
                }
                setFormData(prev => {
                    const newState = { ...prev, [name]: value };
                    if (name.startsWith('dob')) {
                        const year = newState.dobYear || prev.dobYear, month = newState.dobMonth || prev.dobMonth, day = newState.dobDay || prev.dobDay;
                        if (year && month && day) {
                            newState.dateOfBirth = `${year}-${month}-${day}`;
                            setErrors(prevErrors => { const { dateOfBirth, ...rest } = prevErrors; return rest; });
                        } else {
                            newState.dateOfBirth = '';
                        }
                    }
                    if (name === 'employmentStatus') {
                        return { ...newState, currentEmployer: '', jobTitle: '', yearsExperience: '', studentInstitution: '', expectedGraduation: '', lastEmployer: '', dateLeft: '' };
                    }
                    return newState;
                });
                addLog('fieldInput', { fieldName: name, newValue: value });
            };

            const handleNavigation = async (action) => {
    addLog('navigationAttempt', { action });
    
    if (action === 'back') {
        setStep(prev => prev - 1);
        window.scrollTo({ top: 0, behavior: 'smooth' });
        return;
    }
    
    if (validateStep(step)) {
        addLog('navigationSuccess', { action });
        
        if (step < 5) {
            setStep(prev => prev + 1);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        } else if (step === 5 && action === 'submit') {
            const endTime = performance.now();
            const completionTime = ((endTime - (firstInteraction || endTime)) / 1000).toFixed(2);
            const totalErrors = logs.filter(l => l.event === 'validationError').length;
            
            addLog('formSubmit', { 
                timestamp: endTime, 
                completionTime, 
                totalErrors, 
                errorCategories 
            });
            
            const storedData = JSON.parse(localStorage.getItem('formStudyData') || '{}');
            localStorage.setItem('formStudyData', JSON.stringify({ 
                ...storedData, 
                status: { 
                    ...storedData.status, 
                    'C': { 
                        status: 'complete', 
                        errors: totalErrors, 
                        errorCategories, 
                        time: completionTime 
                    } 
                } 
            }));
            
            // Mark this variant as complete
            const studyData = JSON.parse(localStorage.getItem('formStudyData'));
            const currentVariant = new URLSearchParams(window.location.search).get('variant');
            studyData.status[`variant_${currentVariant}_complete`] = true;
            
            // Always go to NASA-TLX after completing a form
            localStorage.setItem('formStudyData', JSON.stringify(studyData));
            window.location.href = `NASATLX.html?participant=${participantId.current}&variant=${currentVariant}`;
        }
    } else {
        addLog('navigationBlock', { 
            action, 
            reason: 'validation_errors', 
            errorCount: Object.keys(errors).length, 
            errorCategories 
        });
        
        if (errorModalRef.current) {
            errorModalRef.current.style.display = 'flex';
            setTimeout(() => { 
                errorModalRef.current.style.display = 'none'; 
            }, 3000);
        }
    }
};
            const renderField = (fc) => {
                const { name, label, type, required, colSpan = 1, futureYears = 0 } = fc;
                const hasError = errors[name], colClass = colSpan === 2 ? 'md:col-span-2' : '';
                const baseClass = `w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${hasError ? 'border-red-500 focus:ring-red-500' : 'border-gray-300 focus:ring-indigo-500'}`;
                
                if (type === 'file') return (<div key={name} className={colClass}><label className="block text-sm font-medium text-gray-700 mb-1">{label} {required && '*'}</label><input type="file" name={name} onChange={handleChange} onFocus={() => handleFocus(name)} accept=".pdf,.doc,.docx" autoComplete="off" className={baseClass} />{formData[name] && <p className="text-xs text-gray-600 mt-1">Selected: {formData[name].name}</p>}{hasError && <p className="text-red-500 text-xs mt-1">{hasError}</p>}</div>);
                if (type === 'textarea') return (<div key={name} className={colClass}><label className="block text-sm font-medium text-gray-700 mb-1">{label} {required && '*'}</label><textarea name={name} value={formData[name] || ''} onChange={handleChange} onFocus={() => handleFocus(name)} onBlur={(e) => handleBlur(name, e.target.value, type)} rows="4" autoComplete="off" className={baseClass} placeholder={`Enter your ${label.toLowerCase()} here...`} />{hasError && <p className="text-red-500 text-xs mt-1">{hasError}</p>}</div>);
                if (type === 'select') {
                    let options = name === 'employmentStatus' ? ['Select...', 'Employed', 'Unemployed', 'Student'] : name === 'desiredPosition' ? ['Select...', 'Software Engineer', 'Product Manager', 'Designer', 'Data Analyst', 'Other'] : ['Select...'];
                    return (<div key={name} className={colClass}><label className="block text-sm font-medium text-gray-700 mb-1">{label} {required && '*'}</label><select name={name} value={formData[name] || ''} onChange={handleChange} onFocus={() => handleFocus(name)} onBlur={(e) => handleBlur(name, e.target.value, type)} autoComplete="off" className={baseClass}>{options.map(opt => <option key={opt} value={opt === 'Select...' ? '' : opt.toLowerCase()}>{opt}</option>)}</select>{hasError && <p className="text-red-500 text-xs mt-1">{hasError}</p>}</div>);
                }
                if (type === 'number-select') return (<div key={name} className={colClass}><label className="block text-sm font-medium text-gray-700 mb-1">{label} {required && '*'}</label><select name={name} value={formData[name] || ''} onChange={handleChange} onFocus={() => handleFocus(name)} onBlur={(e) => handleBlur(name, e.target.value, type)} autoComplete="off" className={baseClass}><option value="">Select Years</option>{Array.from({ length: 51 }, (_, i) => i).map(year => <option key={year} value={year}>{year} {year === 1 ? 'year' : 'years'}</option>)}</select>{hasError && <p className="text-red-500 text-xs mt-1">{hasError}</p>}</div>);
                if (type === 'year-select') {
                    const currentYear = new Date().getFullYear(), startYear = currentYear - 100, endYear = currentYear + futureYears;
                    return (<div key={name} className={colClass}><label className="block text-sm font-medium text-gray-700 mb-1">{label} {required && '*'}</label><select name={name} value={formData[name] || ''} onChange={handleChange} onFocus={() => handleFocus(name)} onBlur={(e) => handleBlur(name, e.target.value, type)} autoComplete="off" className={baseClass}><option value="">Select Year</option>{Array.from({ length: endYear - startYear + 1 }, (_, i) => endYear - i).map(year => <option key={year} value={year}>{year}</option>)}</select>{hasError && <p className="text-red-500 text-xs mt-1">{hasError}</p>}</div>);
                }
                if (type === 'date-composite') return (<div key={name} className={colClass}><label className="block text-sm font-medium text-gray-700 mb-1">{label} {required && '*'}</label><div className="grid grid-cols-3 gap-2"><select name="dobYear" value={formData.dobYear || ''} onChange={handleChange} onFocus={() => handleFocus('dobYear')} onBlur={(e) => handleBlur('dobYear', e.target.value, type)} autoComplete="off" className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${errors.dateOfBirth ? 'border-red-500' : 'border-gray-300 focus:ring-indigo-500'}`}><option value="">Year</option>{Array.from({ length: 100 }, (_, i) => new Date().getFullYear() - i).map(year => <option key={year} value={year}>{year}</option>)}</select><select name="dobMonth" value={formData.dobMonth || ''} onChange={handleChange} onFocus={() => handleFocus('dobMonth')} onBlur={(e) => handleBlur('dobMonth', e.target.value, type)} autoComplete="off" className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${errors.dateOfBirth ? 'border-red-500' : 'border-gray-300 focus:ring-indigo-500'}`}><option value="">Month</option>{Array.from({ length: 12 }, (_, i) => String(i + 1).padStart(2, '0')).map(month => <option key={month} value={month}>{new Date(0, month-1).toLocaleString('default', { month: 'short' })}</option>)}</select><select name="dobDay" value={formData.dobDay || ''} onChange={handleChange} onFocus={() => handleFocus('dobDay')} onBlur={(e) => handleBlur('dobDay', e.target.value, type)} autoComplete="off" className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${errors.dateOfBirth ? 'border-red-500' : 'border-gray-300 focus:ring-indigo-500'}`}><option value="">Day</option>{Array.from({ length: 31 }, (_, i) => String(i + 1).padStart(2, '0')).map(day => <option key={day} value={day}>{day}</option>)}</select></div>{errors.dateOfBirth && <p className="text-red-500 text-xs mt-1">{errors.dateOfBirth}</p>}</div>);
                return (<div key={name} className={colClass}><label className="block text-sm font-medium text-gray-700 mb-1">{label} {required && '*'}</label><input type={type} name={name} value={formData[name] || ''} onChange={handleChange} onFocus={() => handleFocus(name)} onBlur={(e) => handleBlur(name, e.target.value, type)} autoComplete="off" className={baseClass} required={required} />{hasError && <p className="text-red-500 text-xs mt-1">{hasError}</p>}</div>);
            };

            const renderCurrentStepFields = () => {
                const status = formData.employmentStatus;
                let fieldsInCurrentStep = ALL_FIELDS.filter(f => f.step === step);
                if (step === 3) {
                    const baseFields = fieldsInCurrentStep.filter(f => !f.conditional);
                    const conditionalFields = fieldsInCurrentStep.filter(f => f.conditional && f.conditional === status);
                    fieldsInCurrentStep = [...baseFields, ...conditionalFields];
                }
                return (<div className="mb-8 p-6 rounded-xl bg-gray-50/70 shadow-inner"><h3 className="text-xl font-bold text-indigo-700 mb-6 pb-2 border-b-2 border-indigo-300">{STEPS_META[step].name}</h3><div className="grid grid-cols-1 md:grid-cols-2 gap-4">{fieldsInCurrentStep.map(renderField)}</div></div>);
            };

            const isStepLocked = (stepNumber) => stepNumber > step;

            const renderStepContent = (stepNumber) => {
                const locked = isStepLocked(stepNumber);
                if (stepNumber === step) return renderCurrentStepFields();
                if (locked) return (<div className="bg-white rounded-xl shadow-lg p-6 mb-8 border-l-4 border-gray-300 relative min-h-[150px] flex items-center justify-center"><div className="absolute inset-0 bg-gray-50 opacity-90 rounded-xl z-10 flex flex-col items-center justify-center text-gray-500"><Lock size={32} className="text-gray-400 mb-2"/><p className="text-lg font-semibold">Step {stepNumber} is locked.</p><p className="text-sm">Complete all required fields in Step {stepNumber - 1} to unlock.</p></div><div className="locked-content grid grid-cols-1 md:grid-cols-2 gap-4 w-full">{ALL_FIELDS.filter(f => f.step === stepNumber).map(field => (<div key={field.name} className={field.colSpan === 2 ? 'md:col-span-2' : ''}><label className="block text-sm font-medium text-gray-700 mb-1">{field.label} {field.required && '*'}</label><input className="w-full px-3 py-2 border rounded-md border-gray-300 bg-gray-100" disabled /></div>))}</div></div>);
                return (<div className="bg-white rounded-xl shadow-lg p-6 mb-8 border-l-4 border-indigo-500"><h3 className="text-xl font-bold text-indigo-700 flex items-center mb-2"><Check size={18} className="text-indigo-600 mr-2 border-2 border-indigo-600 rounded-full p-0.5" />{STEPS_META[stepNumber].name} - Complete</h3><p className="text-sm text-gray-500">You may navigate back to this step using the 'Back' button if needed.</p></div>);
            };

            const renderProgressBar = () => (<div className="mb-8 p-4 bg-white rounded-xl shadow-lg"><nav aria-label="Progress" className="w-full"><ol role="list" className="flex items-center justify-between">{[...Array(5)].map((_, index) => { const stepNumber = index + 1, isCurrent = stepNumber === step, isLocked = isStepLocked(stepNumber), isCompleted = stepNumber < step; let circleClasses = 'w-10 h-10 flex items-center justify-center rounded-full font-bold text-sm transition duration-300 ease-in-out z-10', lineClasses = 'flex-1 h-1 transition duration-300 ease-in-out'; if (isCompleted) { circleClasses += ' bg-indigo-600 text-white'; lineClasses += ' bg-indigo-600'; } else if (isCurrent) { circleClasses += ' bg-indigo-500 text-white shadow-lg ring-4 ring-indigo-200'; lineClasses += ' bg-gray-300'; } else if (isLocked) { circleClasses += ' bg-gray-100 border-2 border-gray-300 text-gray-500'; lineClasses += ' bg-gray-300'; } else { circleClasses += ' bg-white border-2 border-gray-300 text-gray-500'; lineClasses += ' bg-gray-300'; } return (<React.Fragment key={stepNumber}><li className="flex items-center"><div className={circleClasses}>{isCompleted ? <Check size={16} /> : (isLocked ? <Lock size={18} className="text-gray-500" /> : stepNumber)}</div></li>{stepNumber < 5 && <div className={lineClasses}></div>}</React.Fragment>); })}</ol></nav><div className="text-center text-indigo-700 font-semibold mt-4">Step {step} of 5: {STEPS_META[step].name}</div></div>);

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 p-4 sm:p-8 font-sans">
                    <div ref={errorModalRef} style={{ display: 'none' }} className="fixed top-4 right-4 z-50 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg shadow-xl animate-fade-in-down transition duration-500 ease-in-out hidden items-center space-x-2" role="alert">
                        <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd"></path></svg>
                        <p className="font-medium text-sm">Please correct the highlighted error(s) to continue.</p>
                    </div>

                    <form onSubmit={(e) => e.preventDefault()} className="max-w-4xl mx-auto bg-white rounded-xl shadow-2xl p-6 sm:p-10">
                        <div className="mb-8">
                            <h1 className="text-3xl font-extrabold text-gray-900 mb-2">Job Application Form</h1>
                            <p className="text-gray-600">Variant C: Progressive Disclosure & Conditional Logic</p>
                            <p className="text-sm text-gray-500 mt-1">Participant ID: {participantId.current}</p>
                        </div>

                        {renderProgressBar()}

                        <div className="space-y-6">
                            {[...Array(5)].map((_, index) => { 
                                const stepNumber = index + 1; 
                                return (
                                    <div key={stepNumber} style={{ display: stepNumber === step ? 'block' : 'none' }}>
                                        {renderStepContent(stepNumber)}
                                    </div>
                                ); 
                            })}
                        </div>

                        <div className="flex justify-between pt-8 border-t mt-8">
                            <button 
                                type="button" 
                                onClick={() => handleNavigation('back')} 
                                disabled={step === 1} 
                                className={`px-6 py-3 rounded-lg font-semibold transition ${step === 1 ? 'bg-gray-200 text-gray-500 cursor-not-allowed' : 'bg-white text-indigo-600 border border-indigo-600 hover:bg-indigo-50 shadow-md'}`}
                            >
                                Back
                            </button>

                            {step < 5 && (
                                <button 
                                    type="button" 
                                    onClick={() => handleNavigation('next')} 
                                    className="bg-indigo-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-indigo-700 transition shadow-md"
                                >
                                    Next Step
                                </button>
                            )}

                            {step === 5 && (
                                <button 
                                    type="button" 
                                    onClick={() => handleNavigation('submit')} 
                                    className="bg-green-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-green-700 transition shadow-md"
                                >
                                    Submit Application
                                </button>
                            )}
                        </div>
                    </form>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ProgressiveForm />);
    </script>
</body>
</html>