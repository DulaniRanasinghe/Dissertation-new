<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NASA-TLX Workload Assessment</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, #10b981 0%, #f59e0b 50%, #ef4444 100%);
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #4f46e5;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: all 0.2s;
        }
        input[type="range"]::-webkit-slider-thumb:hover {
            background: #4338ca;
            transform: scale(1.1);
        }
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #4f46e5;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: all 0.2s;
        }
        input[type="range"]::-moz-range-thumb:hover {
            background: #4338ca;
            transform: scale(1.1);
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 font-sans">
    <div class="min-h-screen p-4 sm:p-8">
        <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-2xl p-6 sm:p-10 border-t-8 border-indigo-600 fade-in">
            <div class="mb-8 text-center">
                <h1 class="text-4xl font-extrabold text-gray-900 mb-2">NASA Task Load Index (TLX)</h1>
                <p class="text-gray-600 mb-2">Workload Assessment Questionnaire</p>
                <p class="text-sm text-gray-500">Please rate your experience with the form you just completed</p>
                <div class="mt-4 p-3 bg-indigo-50 rounded-lg inline-block">
                    <p class="text-sm text-gray-700">Participant ID: <span id="participantId" class="font-bold text-indigo-700"></span></p>
                    <p class="text-sm text-gray-700">Form Variant: <span id="formVariant" class="font-bold text-indigo-700"></span></p>
                </div>
            </div>

            <div class="mb-8 p-4 bg-blue-50 border-l-4 border-blue-500 rounded">
                <p class="text-sm text-gray-700">
                    <strong>Instructions:</strong> Please rate each dimension on a scale from 0 to 100. 
                    Move the slider to indicate your rating for each aspect of the task you just completed.
                </p>
            </div>

            <form id="tlxForm" class="space-y-8">
                <div class="p-6 bg-gray-50 rounded-xl shadow-sm">
                    <div class="mb-4">
                        <h3 class="text-lg font-bold text-gray-900 mb-2">Mental Demand</h3>
                        <p class="text-sm text-gray-600">How mentally demanding was the task?</p>
                    </div>
                    <div class="relative mb-3">
                        <input type="range" id="mentalDemand" name="mentalDemand" min="0" max="100" value="50" class="w-full" oninput="updateValue('mentalDemand')">
                    </div>
                    <div class="flex justify-between text-xs text-gray-600 mb-2">
                        <span>Very Low</span>
                        <span class="font-bold text-indigo-600 text-base" id="mentalDemandValue">50</span>
                        <span>Very High</span>
                    </div>
                </div>

                <div class="p-6 bg-gray-50 rounded-xl shadow-sm">
                    <div class="mb-4">
                        <h3 class="text-lg font-bold text-gray-900 mb-2">Physical Demand</h3>
                        <p class="text-sm text-gray-600">How physically demanding was the task?</p>
                    </div>
                    <div class="relative mb-3">
                        <input type="range" id="physicalDemand" name="physicalDemand" min="0" max="100" value="50" class="w-full" oninput="updateValue('physicalDemand')">
                    </div>
                    <div class="flex justify-between text-xs text-gray-600 mb-2">
                        <span>Very Low</span>
                        <span class="font-bold text-indigo-600 text-base" id="physicalDemandValue">50</span>
                        <span>Very High</span>
                    </div>
                </div>

                <div class="p-6 bg-gray-50 rounded-xl shadow-sm">
                    <div class="mb-4">
                        <h3 class="text-lg font-bold text-gray-900 mb-2">Temporal Demand</h3>
                        <p class="text-sm text-gray-600">How hurried or rushed was the pace of the task?</p>
                    </div>
                    <div class="relative mb-3">
                        <input type="range" id="temporalDemand" name="temporalDemand" min="0" max="100" value="50" class="w-full" oninput="updateValue('temporalDemand')">
                    </div>
                    <div class="flex justify-between text-xs text-gray-600 mb-2">
                        <span>Very Low</span>
                        <span class="font-bold text-indigo-600 text-base" id="temporalDemandValue">50</span>
                        <span>Very High</span>
                    </div>
                </div>

                <div class="p-6 bg-gray-50 rounded-xl shadow-sm">
                    <div class="mb-4">
                        <h3 class="text-lg font-bold text-gray-900 mb-2">Performance</h3>
                        <p class="text-sm text-gray-600">How successful were you in accomplishing what you were asked to do?</p>
                    </div>
                    <div class="relative mb-3">
                        <input type="range" id="performance" name="performance" min="0" max="100" value="50" class="w-full" oninput="updateValue('performance')">
                    </div>
                    <div class="flex justify-between text-xs text-gray-600 mb-2">
                        <span>Perfect</span>
                        <span class="font-bold text-indigo-600 text-base" id="performanceValue">50</span>
                        <span>Failure</span>
                    </div>
                </div>

                <div class="p-6 bg-gray-50 rounded-xl shadow-sm">
                    <div class="mb-4">
                        <h3 class="text-lg font-bold text-gray-900 mb-2">Effort</h3>
                        <p class="text-sm text-gray-600">How hard did you have to work to accomplish your level of performance?</p>
                    </div>
                    <div class="relative mb-3">
                        <input type="range" id="effort" name="effort" min="0" max="100" value="50" class="w-full" oninput="updateValue('effort')">
                    </div>
                    <div class="flex justify-between text-xs text-gray-600 mb-2">
                        <span>Very Low</span>
                        <span class="font-bold text-indigo-600 text-base" id="effortValue">50</span>
                        <span>Very High</span>
                    </div>
                </div>

                <div class="p-6 bg-gray-50 rounded-xl shadow-sm">
                    <div class="mb-4">
                        <h3 class="text-lg font-bold text-gray-900 mb-2">Frustration</h3>
                        <p class="text-sm text-gray-600">How insecure, discouraged, irritated, stressed, and annoyed were you?</p>
                    </div>
                    <div class="relative mb-3">
                        <input type="range" id="frustration" name="frustration" min="0" max="100" value="50" class="w-full" oninput="updateValue('frustration')">
                    </div>
                    <div class="flex justify-between text-xs text-gray-600 mb-2">
                        <span>Very Low</span>
                        <span class="font-bold text-indigo-600 text-base" id="frustrationValue">50</span>
                        <span>Very High</span>
                    </div>
                </div>

                <div class="flex justify-between pt-8 border-t mt-8">
                    <button type="button" onclick="window.history.back()" class="bg-gray-400 text-white px-8 py-3 rounded-lg font-semibold hover:bg-gray-500 transition shadow-md">
                        Back
                    </button>
                    <button type="submit" class="bg-green-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-green-700 transition shadow-md">
                        Submit Assessment
                    </button>
                </div>
            </form>

            <div id="results" class="hidden mt-8 p-6 bg-green-50 border-2 border-green-400 rounded-xl">
                <div class="text-center mb-4">
                    <svg class="w-16 h-16 mx-auto text-green-600 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <h2 class="text-2xl font-bold text-gray-900">Assessment Complete!</h2>
                    <p class="text-gray-600 mt-2">Your workload scores have been recorded.</p>
                </div>
                
                <div class="bg-white p-4 rounded-lg shadow-inner">
                    <h3 class="font-bold text-lg mb-3 text-center text-indigo-700">Overall Workload Score</h3>
                    <div class="text-center">
                        <p class="text-5xl font-extrabold text-indigo-600" id="overallScore">0</p>
                        <p class="text-sm text-gray-500 mt-1">out of 100</p>
                    </div>
                </div>

                <div class="mt-6 text-center">
                    <button onclick="window.location.href='index.html'" class="bg-indigo-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-indigo-700 transition shadow-md">
                        Return to Index
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        
        const urlParams = new URLSearchParams(window.location.search);
        const participantId = urlParams.get('participant') || (localStorage.getItem('formStudyData') ? JSON.parse(localStorage.getItem('formStudyData')).participantId : 'Unknown');
        const formVariant = urlParams.get('variant') || 'Unknown';

        document.getElementById('participantId').textContent = participantId;
        document.getElementById('formVariant').textContent = `Variant ${formVariant}`;

        function updateValue(dimension) {
            const value = document.getElementById(dimension).value;
            document.getElementById(dimension + 'Value').textContent = value;
        }


        document.getElementById('tlxForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const scores = {
        participantId: participantId,
        variant: formVariant,
        timestamp: new Date().toISOString(),
        mentalDemand: parseInt(formData.get('mentalDemand')),
        physicalDemand: parseInt(formData.get('physicalDemand')),
        temporalDemand: parseInt(formData.get('temporalDemand')),
        performance: parseInt(formData.get('performance')),
        effort: parseInt(formData.get('effort')),
        frustration: parseInt(formData.get('frustration'))
    };
    
    const overallScore = (
        scores.mentalDemand + 
        scores.physicalDemand + 
        scores.temporalDemand + 
        scores.performance + 
        scores.effort + 
        scores.frustration
    ) / 6;
    scores.overallScore = overallScore.toFixed(2);
    
    const storageKey = `nasa_tlx_${formVariant}`;
    let allTLXData = JSON.parse(localStorage.getItem(storageKey) || '{}');
    allTLXData[participantId] = scores;
    localStorage.setItem(storageKey, JSON.stringify(allTLXData));
    
    document.getElementById('overallScore').textContent = scores.overallScore;
    document.getElementById('tlxForm').classList.add('hidden');
    document.getElementById('results').classList.remove('hidden');
    
    // Mark NASA-TLX as complete for this variant
    const studyData = JSON.parse(localStorage.getItem('formStudyData'));
    studyData.status[`nasaTLX_${formVariant}_complete`] = true;
    studyData.currentVariantIndex++;
    
    // Check if all 3 variants are complete
    if (studyData.currentVariantIndex >= 3) {
        // All done - go to interview
        studyData.status.allFormsComplete = true;
        localStorage.setItem('formStudyData', JSON.stringify(studyData));
        
        document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'start' });
        
        // Auto-redirect to interview after 3 seconds
        setTimeout(() => {
            window.location.href = `Interviews.html?participant=${participantId}&variant=ALL`;
        }, 3000);
    } else {
        // Go to next variant
        localStorage.setItem('formStudyData', JSON.stringify(studyData));
        const nextVariant = studyData.variantOrder[studyData.currentVariantIndex];
        const nextFile = nextVariant === 'A' ? 'VariantA.html' : nextVariant === 'B' ? 'VariantB.html' : 'VariantC.html';
        
        document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'start' });
        
        // Auto-redirect to next form after 3 seconds
        setTimeout(() => {
            window.location.href = `${nextFile}?participant=${participantId}&variant=${nextVariant}`;
        }, 3000);
    }
});
    </script>
</body>
</html>