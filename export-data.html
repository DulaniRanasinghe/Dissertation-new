<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Export Study Data</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 p-8">
    <div class="max-w-4xl mx-auto">
        
        <!-- Main Export Section -->
        <div id="mainSection" class="bg-white rounded-xl shadow-2xl p-8 mb-6">
            <h1 class="text-3xl font-bold text-gray-900 mb-6">üìä Export Study Data</h1>
            
            <div class="mb-8 p-6 bg-blue-50 border-l-4 border-blue-500 rounded">
                <h2 class="font-bold text-lg mb-2">Instructions:</h2>
                <p class="text-gray-700">Click the button below to download all collected data as a ZIP file containing:</p>
                <ul class="list-disc ml-6 mt-2 text-gray-700">
                    <li>variant_a_data.csv - Detailed field-level analytics for Variant A</li>
                    <li>variant_b_data.csv - Detailed field-level analytics for Variant B</li>
                    <li>variant_c_data.csv - Detailed field-level analytics for Variant C</li>
                    <li>nasa_tlx_data.csv - All NASA-TLX workload scores</li>
                    <li>interview_data.csv - Interview metadata</li>
                    <li>audio/ folder - All interview audio recordings</li>
                </ul>
            </div>

            <div id="dataPreview" class="mb-6 p-4 bg-gray-50 rounded-lg">
                <h3 class="font-bold mb-3">Data Summary:</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="p-3 bg-white rounded shadow-sm">
                        <p class="text-sm text-gray-600">Variant A Submissions</p>
                        <p class="text-2xl font-bold text-indigo-600" id="countVariantA">0</p>
                    </div>
                    <div class="p-3 bg-white rounded shadow-sm">
                        <p class="text-sm text-gray-600">Variant B Submissions</p>
                        <p class="text-2xl font-bold text-indigo-600" id="countVariantB">0</p>
                    </div>
                    <div class="p-3 bg-white rounded shadow-sm">
                        <p class="text-sm text-gray-600">Variant C Submissions</p>
                        <p class="text-2xl font-bold text-indigo-600" id="countVariantC">0</p>
                    </div>
                    <div class="p-3 bg-white rounded shadow-sm">
                        <p class="text-sm text-gray-600">NASA-TLX Responses</p>
                        <p class="text-2xl font-bold text-green-600" id="countNASA">0</p>
                    </div>
                    <div class="p-3 bg-white rounded shadow-sm">
                        <p class="text-sm text-gray-600">Interview Recordings</p>
                        <p class="text-2xl font-bold text-orange-600" id="countInterviews">0</p>
                    </div>
                    <div class="p-3 bg-white rounded shadow-sm">
                        <p class="text-sm text-gray-600">Total Audio Files</p>
                        <p class="text-2xl font-bold text-purple-600" id="countAudio">0</p>
                    </div>
                </div>
            </div>

            <button id="exportBtn" onclick="exportAllData()"
                    class="w-full bg-green-600 text-white px-8 py-4 rounded-lg font-bold text-lg hover:bg-green-700 transition shadow-lg">
                üì• Step 1: Download Data as ZIP
            </button>

            <div id="progressContainer" class="hidden mt-6">
                <div class="bg-gray-200 rounded-full h-4 overflow-hidden">
                    <div id="progressBar" class="bg-green-600 h-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <p id="progressText" class="text-center mt-2 text-sm text-gray-600">Preparing download...</p>
            </div>
        </div>

        <!-- Google Drive Upload Section -->
        <div id="directUploadSection" class="hidden bg-white rounded-xl shadow-2xl p-8 mb-6">
            <div class="bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-500 rounded-xl p-6 shadow-lg">
                <div class="flex items-center gap-3 mb-6">
                    <svg class="w-16 h-16 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <div>
                        <h2 class="text-3xl font-bold text-gray-900">‚úÖ Download Complete!</h2>
                        <p class="text-lg text-gray-700">File saved: <span id="fileName" class="font-mono font-semibold text-green-700"></span></p>
                    </div>
                </div>

                <div class="bg-blue-100 border-l-4 border-blue-600 p-6 mb-6 rounded-lg">
                    <h3 class="text-2xl font-bold text-gray-900 mb-4">üì§ Step 2: Upload to Google Drive</h3>
                    <p class="text-gray-800 text-lg">Click the button below to upload your ZIP file to the research folder.</p>
                </div>

                <div class="bg-white rounded-xl p-8 mb-6 border-2 border-blue-200 shadow-lg">
                    <div class="flex items-start gap-4 mb-6">
                        <div class="text-5xl">‚òÅÔ∏è</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-2xl text-gray-900 mb-4">Upload to Google Drive</h4>
                            
                            <button onclick="openDriveUpload()" 
                                    class="w-full bg-blue-600 text-white px-8 py-6 rounded-xl font-bold text-2xl hover:bg-blue-700 transition shadow-lg hover:shadow-xl transform hover:scale-[1.02] mb-6">
                                üìÅ Open Upload Folder
                            </button>

                            <div class="bg-blue-50 rounded-lg p-6">
                                <p class="font-bold text-lg text-gray-900 mb-4">üìù Follow these steps:</p>
                                <ol class="space-y-3 text-gray-700">
                                    <li class="flex items-start gap-3">
                                        <span class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">1</span>
                                        <span class="pt-1">Click <strong>"Open Upload Folder"</strong> button above</span>
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <span class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">2</span>
                                        <span class="pt-1">In Google Drive, click <strong>"New"</strong> ‚Üí <strong>"File upload"</strong></span>
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <span class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">3</span>
                                        <span class="pt-1">Select ZIP file from Downloads:<br>
                                        <span class="font-mono text-sm bg-gray-100 px-2 py-1 rounded mt-1 inline-block" id="uploadFileName">form_study_data_*.zip</span>
                                        </span>
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <span class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">4</span>
                                        <span class="pt-1">Wait for <strong>"Upload complete"</strong> message</span>
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <span class="flex-shrink-0 w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center font-bold">‚úì</span>
                                        <span class="pt-1"><strong>Done!</strong> Click "I've Uploaded" below</span>
                                    </li>
                                </ol>
                            </div>

                            <div class="mt-6 p-4 bg-yellow-50 border-l-4 border-yellow-500 rounded">
                                <p class="text-sm text-gray-700">
                                    <strong>üí° Tip:</strong> You may need to sign in to Google Drive. Use any Google account.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-white p-4 rounded-lg border-2 border-green-200 shadow-sm">
                        <div class="flex items-center gap-3">
                            <span class="text-3xl">‚úÖ</span>
                            <div>
                                <p class="font-bold text-gray-900">Direct Upload</p>
                                <p class="text-xs text-gray-600">To researcher's Drive</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg border-2 border-green-200 shadow-sm">
                        <div class="flex items-center gap-3">
                            <span class="text-3xl">üîí</span>
                            <div>
                                <p class="font-bold text-gray-900">Secure</p>
                                <p class="text-xs text-gray-600">Google encryption</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg border-2 border-green-200 shadow-sm">
                        <div class="flex items-center gap-3">
                            <span class="text-3xl">‚ö°</span>
                            <div>
                                <p class="font-bold text-gray-900">Fast</p>
                                <p class="text-xs text-gray-600">Under 1 minute</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-center">
                    <button onclick="confirmUploaded()" 
                            class="bg-green-600 text-white px-12 py-4 rounded-xl font-bold text-lg hover:bg-green-700 transition shadow-lg">
                        ‚úÖ I've Uploaded the File
                    </button>
                </div>

                <div class="mt-6 p-4 bg-blue-50 border-l-4 border-blue-500 rounded">
                    <p class="text-sm text-gray-700">
                        <strong>‚ö†Ô∏è Important:</strong> Please complete upload within 24 hours.
                    </p>
                </div>
            </div>
        </div>

        <!-- Upload Success Section -->
        <div id="uploadSuccessSection" class="hidden bg-white rounded-xl shadow-2xl p-8">
            <div class="bg-gradient-to-br from-green-100 to-emerald-100 border-2 border-green-600 rounded-xl p-12 text-center">
                <svg class="w-24 h-24 mx-auto text-green-600 mb-6 animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <h2 class="text-4xl font-bold text-green-900 mb-4">Upload Complete! üéâ</h2>
                <p class="text-xl text-green-800 mb-6">Thank you for uploading your data!</p>
                <div class="bg-white rounded-xl p-6 mb-6 shadow-lg">
                    <p class="text-gray-700 mb-4">
                        <strong class="text-2xl">‚úÖ All Done!</strong>
                    </p>
                    <p class="text-sm text-gray-600">
                        ‚òÅÔ∏è Your data has been uploaded to Google Drive<br>
                        üåê You can now safely close this browser<br>
                        üóëÔ∏è Feel free to clear your browsing data if desired<br>
                        üôè Thank you for participating in this research study!
                    </p>
                </div>
            </div>
        </div>

    </div>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        const GOOGLE_DRIVE_FOLDER_URL = 'https://drive.google.com/drive/folders/1YrwxScyDKWk0gJItd_hjykW9sLc6sKE5?usp=drive_link';
        // ‚Üê REPLACE with your Google Drive folder link!

        // ============================================
        // DATA SUMMARY
        // ============================================
        function updateDataSummary() {
            const logsA = JSON.parse(localStorage.getItem('logs_A') || '{}');
            const logsB = JSON.parse(localStorage.getItem('logs_B') || '{}');
            const logsC = JSON.parse(localStorage.getItem('logs_C') || '{}');
            const interviews = JSON.parse(localStorage.getItem('interviews') || '{}');
            
            const nasaA = JSON.parse(localStorage.getItem('nasa_tlx_A') || '{}');
            const nasaB = JSON.parse(localStorage.getItem('nasa_tlx_B') || '{}');
            const nasaC = JSON.parse(localStorage.getItem('nasa_tlx_C') || '{}');
            const totalNASA = Object.keys(nasaA).length + Object.keys(nasaB).length + Object.keys(nasaC).length;
            
            let audioCount = 0;
            Object.values(interviews).forEach(interview => {
                if (interview.recordings) {
                    audioCount += Object.keys(interview.recordings).length;
                }
            });

            document.getElementById('countVariantA').textContent = Object.keys(logsA).length;
            document.getElementById('countVariantB').textContent = Object.keys(logsB).length;
            document.getElementById('countVariantC').textContent = Object.keys(logsC).length;
            document.getElementById('countNASA').textContent = totalNASA;
            document.getElementById('countInterviews').textContent = Object.keys(interviews).length;
            document.getElementById('countAudio').textContent = audioCount;
        }

        function getParticipantId() {
            const studyData = JSON.parse(localStorage.getItem('formStudyData') || '{}');
            return studyData.participantId || 'Unknown';
        }

        // ============================================
        // CSV EXPORT FUNCTIONS
        // ============================================
        function jsonToCSV(data, headers) {
            if (!data || data.length === 0) return '';
            
            const csv = [];
            csv.push(headers.join(','));
            
            data.forEach(row => {
                const values = headers.map(header => {
                    let value = row[header];
                    if (value === null || value === undefined) value = '';
                    if (typeof value === 'string' && (value.includes(',') || value.includes('"') || value.includes('\n'))) {
                        value = '"' + value.replace(/"/g, '""') + '"';
                    }
                    return value;
                });
                csv.push(values.join(','));
            });
            
            return csv.join('\n');
        }

        // ============================================
        // ENHANCED FIELD-LEVEL ANALYTICS
        // ============================================
        function exportDetailedVariantData(variantLetter) {
            const logs = JSON.parse(localStorage.getItem(`logs_${variantLetter}`) || '{}');
            const data = [];
            
            Object.entries(logs).forEach(([participantId, logData]) => {
                const detailedLogs = logData.detailedLogs || [];
                const fieldMetrics = calculateFieldMetrics(detailedLogs);
                
                data.push({
                    participant_id: participantId,
                    variant: variantLetter,
                    timestamp: logData.timestamp,
                    completion_time: logData.completionTime,
                    total_errors: logData.totalErrors,
                    missing_required_errors: logData.errorCategories?.missing_required || 0,
                    invalid_format_errors: logData.errorCategories?.invalid_format || 0,
                    incomplete_data_errors: logData.errorCategories?.incomplete_data || 0,
                    incomplete_field_count: fieldMetrics.incompleteCount,
                    total_events: logData.totalEvents,
                    first_interaction: logData.firstInteraction,
                    form_submit_time: logData.formSubmitTime,
                    ...fieldMetrics.fields
                });
            });
            
            const baseHeaders = [
                'participant_id', 'variant', 'timestamp', 'completion_time', 'total_errors',
                'missing_required_errors', 'invalid_format_errors', 'incomplete_data_errors',
                'incomplete_field_count', 'total_events', 'first_interaction', 'form_submit_time'
            ];
            
            const fieldNames = [
                'fullName', 'dateOfBirth', 'email', 'phone', 'streetAddress', 'city', 
                'postcode', 'country', 'employmentStatus', 'employer', 'jobTitle', 
                'yearsExperience', 'qualification', 'institution', 'yearCompletion', 
                'desiredPosition', 'startDate', 'salaryExpectations', 'coverLetter', 'cv'
            ];
            
            const fieldHeaders = [];
            fieldNames.forEach(field => {
                fieldHeaders.push(`${field}_char_count`);
                fieldHeaders.push(`${field}_time_spent`);
                fieldHeaders.push(`${field}_completed`);
            });
            
            const allHeaders = [...baseHeaders, ...fieldHeaders];
            return jsonToCSV(data, allHeaders);
        }

        function calculateFieldMetrics(detailedLogs) {
            const fieldData = {};
            const requiredFields = [
                'fullName', 'dateOfBirth', 'email', 'phone', 'streetAddress', 'city', 
                'postcode', 'country', 'employmentStatus', 'qualification', 'institution', 
                'yearCompletion', 'desiredPosition', 'startDate', 'cv'
            ];
            
            const allFields = [
                'fullName', 'dateOfBirth', 'email', 'phone', 'streetAddress', 'city', 
                'postcode', 'country', 'employmentStatus', 'employer', 'jobTitle', 
                'yearsExperience', 'qualification', 'institution', 'yearCompletion', 
                'desiredPosition', 'startDate', 'salaryExpectations', 'coverLetter', 'cv'
            ];
            
            allFields.forEach(field => {
                fieldData[field] = {
                    charCount: 0,
                    timeSpent: 0,
                    completed: false,
                    focusTime: null
                };
            });
            
            detailedLogs.forEach(log => {
                const fieldName = log.fieldName;
                if (!fieldName || !fieldData[fieldName]) return;
                
                if (log.event === 'fieldFocus') {
                    fieldData[fieldName].focusTime = log.timestamp;
                }
                
                if (log.event === 'fieldInput') {
                    fieldData[fieldName].charCount = log.characterCount || 0;
                    if (log.characterCount > 0) {
                        fieldData[fieldName].completed = true;
                    }
                }
                
                if (log.event === 'fieldBlur') {
                    if (fieldData[fieldName].focusTime) {
                        const timeSpent = (log.timestamp - fieldData[fieldName].focusTime) / 1000;
                        fieldData[fieldName].timeSpent += timeSpent;
                    }
                    if (log.characterCount > 0) {
                        fieldData[fieldName].charCount = log.characterCount;
                        fieldData[fieldName].completed = true;
                    }
                }
            });
            
            let incompleteCount = 0;
            requiredFields.forEach(field => {
                if (!fieldData[field].completed) {
                    incompleteCount++;
                }
            });
            
            const fields = {};
            allFields.forEach(field => {
                fields[`${field}_char_count`] = fieldData[field].charCount;
                fields[`${field}_time_spent`] = fieldData[field].timeSpent.toFixed(2);
                fields[`${field}_completed`] = fieldData[field].completed ? 'Yes' : 'No';
            });
            
            return {
                incompleteCount: incompleteCount,
                fields: fields
            };
        }

        function exportNASATLXData() {
            const data = [];
            
            ['A', 'B', 'C'].forEach(variant => {
                const nasaData = JSON.parse(localStorage.getItem(`nasa_tlx_${variant}`) || '{}');
                Object.entries(nasaData).forEach(([participantId, scores]) => {
                    data.push({
                        participant_id: participantId,
                        variant: scores.variant || variant,
                        timestamp: scores.timestamp,
                        mental_demand: scores.mentalDemand,
                        physical_demand: scores.physicalDemand,
                        temporal_demand: scores.temporalDemand,
                        performance: scores.performance,
                        effort: scores.effort,
                        frustration: scores.frustration,
                        overall_score: scores.overallScore
                    });
                });
            });
            
            const headers = [
                'participant_id', 'variant', 'timestamp', 'mental_demand', 'physical_demand',
                'temporal_demand', 'performance', 'effort', 'frustration', 'overall_score'
            ];
            
            return jsonToCSV(data, headers);
        }

        function exportInterviewData() {
            const interviews = JSON.parse(localStorage.getItem('interviews') || '{}');
            const data = [];
            
            Object.entries(interviews).forEach(([participantId, interview]) => {
                const audioCount = interview.recordings ? Object.keys(interview.recordings).length : 0;
                data.push({
                    participant_id: participantId,
                    variant: interview.variant,
                    timestamp: interview.timestamp,
                    audio_files_count: audioCount,
                    audio_folder: `audio/${participantId}_Variant${interview.variant}`
                });
            });
            
            const headers = ['participant_id', 'variant', 'timestamp', 'audio_files_count', 'audio_folder'];
            return jsonToCSV(data, headers);
        }

        // ============================================
        // MAIN EXPORT FUNCTION
        // ============================================
        async function exportAllData() {
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const exportBtn = document.getElementById('exportBtn');
            
            progressContainer.classList.remove('hidden');
            exportBtn.disabled = true;
            exportBtn.classList.add('opacity-50', 'cursor-not-allowed');
            
            try {
                const zip = new JSZip();
                
                function updateProgress(percent, message) {
                    progressBar.style.width = percent + '%';
                    progressText.textContent = message;
                }
                
                updateProgress(10, 'Exporting Variant A data...');
                const variantACSV = exportDetailedVariantData('A');
                if (variantACSV) zip.file('variant_a_data.csv', variantACSV);
                
                updateProgress(20, 'Exporting Variant B data...');
                const variantBCSV = exportDetailedVariantData('B');
                if (variantBCSV) zip.file('variant_b_data.csv', variantBCSV);
                
                updateProgress(30, 'Exporting Variant C data...');
                const variantCCSV = exportDetailedVariantData('C');
                if (variantCCSV) zip.file('variant_c_data.csv', variantCCSV);
                
                updateProgress(40, 'Exporting NASA-TLX data...');
                const nasaCSV = exportNASATLXData();
                if (nasaCSV) zip.file('nasa_tlx_data.csv', nasaCSV);
                
                updateProgress(50, 'Exporting interview metadata...');
                const interviewCSV = exportInterviewData();
                if (interviewCSV) zip.file('interview_data.csv', interviewCSV);
                
                updateProgress(60, 'Collecting audio recordings...');
                const interviews = JSON.parse(localStorage.getItem('interviews') || '{}');
                const audioFolder = zip.folder('audio');
                
                let audioProcessed = 0;
                const totalAudio = Object.values(interviews).reduce((sum, interview) => {
                    return sum + (interview.recordings ? Object.keys(interview.recordings).length : 0);
                }, 0);
                
                for (const [participantId, interview] of Object.entries(interviews)) {
                    if (interview.recordings) {
                        const participantFolder = audioFolder.folder(`${participantId}_Variant${interview.variant}`);
                        
                        for (const [questionKey, base64Audio] of Object.entries(interview.recordings)) {
                            if (base64Audio && base64Audio.startsWith('data:audio')) {
                                const base64Data = base64Audio.split(',')[1];
                                const fileName = `${questionKey}.wav`;
                                participantFolder.file(fileName, base64Data, { base64: true });
                                
                                audioProcessed++;
                                const audioProgress = 60 + (audioProcessed / totalAudio) * 30;
                                updateProgress(audioProgress, `Processing audio files... (${audioProcessed}/${totalAudio})`);
                            }
                        }
                    }
                }
                
                updateProgress(95, 'Creating documentation...');
                const readme = `Form Study Data Export
======================

Export Date: ${new Date().toISOString()}
Participant ID: ${getParticipantId()}

Enhanced CSV Format:
-------------------
Each variant CSV now includes detailed field-level analytics:
- Completion time and error counts
- Incomplete field count
- Per-field character counts
- Per-field time spent (seconds)
- Per-field completion status (Yes/No)

Files:
------
1. variant_a_data.csv - Variant A with 60+ columns
2. variant_b_data.csv - Variant B with 60+ columns
3. variant_c_data.csv - Variant C with 60+ columns
4. nasa_tlx_data.csv - NASA-TLX workload scores
5. interview_data.csv - Interview metadata
6. audio/ - Interview audio recordings

For questions, contact the researcher.
`;
                zip.file('README.txt', readme);
                
                updateProgress(98, 'Generating ZIP file...');
                const blob = await zip.generateAsync({ type: 'blob' });
                
                updateProgress(100, 'Download ready!');
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                const fileName = `form_study_data_${getParticipantId()}_${new Date().toISOString().split('T')[0]}.zip`;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                setTimeout(() => {
                    document.getElementById('mainSection').classList.add('hidden');
                    document.getElementById('directUploadSection').classList.remove('hidden');
                    document.getElementById('fileName').textContent = fileName;
                    document.getElementById('uploadFileName').textContent = fileName;
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }, 1000);
                
            } catch (error) {
                console.error('Export error:', error);
                progressText.textContent = '‚ùå Export failed: ' + error.message;
                progressBar.classList.add('bg-red-600');
                exportBtn.disabled = false;
                exportBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // ============================================
        // GOOGLE DRIVE UPLOAD FUNCTIONS
        // ============================================
        function openDriveUpload() {
            window.open(GOOGLE_DRIVE_FOLDER_URL, '_blank');
            setTimeout(() => {
                const fileName = document.getElementById('fileName').textContent;
                alert('üìÅ Google Drive Opened!\n\nRemember to:\n1. Click "New" ‚Üí "File upload"\n2. Select: ' + fileName + '\n3. Wait for upload complete\n4. Return here and click "I\'ve Uploaded"');
            }, 2000);
        }

        function confirmUploaded() {
            const confirmed = confirm('‚úÖ Confirm Upload\n\nHave you successfully uploaded the ZIP file to Google Drive?\n\nClick OK if yes, Cancel if you still need to upload.');
            if (confirmed) {
                document.getElementById('directUploadSection').style.display = 'none';
                document.getElementById('uploadSuccessSection').classList.remove('hidden');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                alert('üìÅ No problem!\n\nClick "Open Upload Folder" again to complete the upload.');
            }
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', updateDataSummary);
    </script>
</body>
</html>
